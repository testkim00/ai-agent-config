# Consult (자문)

Codex에게 검토 및 피드백을 받아 더 신뢰성 있는 답변을 제공합니다.

## 사용법

```
/consult {질문 또는 요청}
```

## 처리 흐름

```
┌─────────────────────────────────────────────────────────────────────┐
│ 1단계: 요청 분석 및 초안 작성                         [Claude]      │
│        ├ 1-1. 사용자 요청 분석                                      │
│        ├ 1-2. 관련 정보 수집 (필요시)                               │
│        └ 1-3. 초안 답변/계획 작성                                   │
├─────────────────────────────────────────────────────────────────────┤
│ 2단계: Codex 자문                                    [Codex]        │
│        ├ 2-1. 초안 전달 및 검토 요청                                │
│        ├ 2-2. Codex 피드백 수신                                     │
│        └ 2-3. 피드백 내용 분석                                      │
├─────────────────────────────────────────────────────────────────────┤
│ 3단계: 최종 답변                                     [Claude]       │
│        ├ 3-1. Codex 피드백 반영                                     │
│        ├ 3-2. 최종 답변 작성                                        │
│        └ 3-3. 사용자에게 전달                                       │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 단계별 상세

### 1단계: 요청 분석 및 초안 작성

사용자 요청을 받으면:

1. **요청 분석**
   - 사용자가 원하는 것이 무엇인지 파악
   - 답변 유형 결정 (설계, 코드, 설명, 분석 등)

2. **정보 수집** (필요시)
   - 관련 코드/파일 확인
   - 프로젝트 컨텍스트 파악

3. **초안 작성**
   - 답변 또는 계획의 초안 작성
   - 핵심 논점 정리

---

### 2단계: Codex 자문

Codex에게 검토 요청:

```bash
codex exec "
[자문 요청]

## 사용자 질문
{사용자의 원래 요청}

## Claude 초안
{1단계에서 작성한 초안}

## 검토 요청
위 초안에 대해 다음 관점에서 검토해주세요:
1. 정확성: 기술적으로 틀린 부분이 있는가?
2. 완전성: 빠진 중요한 내용이 있는가?
3. 실용성: 실제 적용 시 문제가 될 부분이 있는가?
4. 개선점: 더 좋은 접근 방법이 있는가?

피드백을 구체적으로 제시해주세요.
" --full-auto
```

**Codex 피드백 수신 후:**
- 동의하는 부분 확인
- 수정이 필요한 부분 식별
- 추가 제안 사항 검토

---

### 3단계: 최종 답변

Codex 피드백을 반영하여:

1. **피드백 반영**
   - 오류 수정
   - 빠진 내용 추가
   - 더 나은 접근 방법 적용

2. **최종 답변 작성**
   - 초안 + Codex 피드백 통합
   - 사용자에게 명확하게 전달

3. **자문 결과 표시** (선택)
   - Codex가 지적한 주요 포인트 요약
   - 어떤 부분이 개선되었는지 설명

---

## 출력 형식

```
═══════════════════════════════════════════════════════════════
                         자문 결과
═══════════════════════════════════════════════════════════════

■ 요청 요약
{사용자 요청 한 줄 요약}

■ Codex 피드백 요약
┌─────────────────────────────────────────────────────────────┐
│ ✓ 정확성: {OK / 수정됨}                                      │
│ ✓ 완전성: {OK / 보완됨}                                      │
│ ✓ 실용성: {OK / 개선됨}                                      │
│ 💡 추가 제안: {있음/없음}                                     │
└─────────────────────────────────────────────────────────────┘

■ 최종 답변
{Codex 피드백이 반영된 최종 답변}

═══════════════════════════════════════════════════════════════
```

---

## 예시

```
/consult Vue 컴포넌트에서 대용량 데이터를 효율적으로 처리하는 방법

→ [1단계: 초안 작성]
  - 가상 스크롤링 사용
  - 페이지네이션 적용
  - 메모이제이션 활용

→ [2단계: Codex 자문]
  Codex 피드백:
  - ✓ 가상 스크롤링 접근 적절
  - 💡 추가: vue-virtual-scroller 라이브러리 추천
  - 💡 추가: Web Worker 활용 고려
  - ⚠️ 메모이제이션 설명 보완 필요

→ [3단계: 최종 답변]
  ═══════════════════════════════════════════════════════════════
                           자문 결과
  ═══════════════════════════════════════════════════════════════

  ■ Codex 피드백 요약
  │ ✓ 정확성: OK
  │ ✓ 완전성: 보완됨 (Web Worker 추가)
  │ ✓ 실용성: OK
  │ 💡 추가 제안: 라이브러리 추천

  ■ 최종 답변
  Vue에서 대용량 데이터 처리 방법:

  1. **가상 스크롤링** (vue-virtual-scroller)
     - 화면에 보이는 항목만 렌더링
     - 10만 건 이상도 부드럽게 처리

  2. **Web Worker 활용**
     - 무거운 연산은 백그라운드에서 처리
     - UI 블로킹 방지

  3. **페이지네이션/무한 스크롤**
     - 서버 측 페이징으로 초기 로드 최소화

  4. **computed + shallowRef**
     - 불필요한 반응성 제거
     - 대용량 배열은 shallowRef 사용

  ═══════════════════════════════════════════════════════════════
```

---

## 언제 사용하면 좋은가?

| 상황 | 적합도 |
|------|--------|
| 중요한 아키텍처 결정 | ⭐⭐⭐ |
| 복잡한 기술 설계 | ⭐⭐⭐ |
| 확신이 없는 답변 | ⭐⭐⭐ |
| 모범 사례 확인 | ⭐⭐ |
| 단순 질문 | ⭐ (불필요) |

---

## 관련 명령어

| 명령어 | 설명 |
|--------|------|
| `/codex` | Codex에게 직접 질문/작업 위임 |
| `/orchestration` | 복잡한 작업 체계적 수행 |

---

## ⚠️ 권한 승인 시 주의사항

`codex exec` 명령 실행 시 권한 요청이 발생하면:

```
┌─────────────────────────────────────────────────────────────────────┐
│ ❌ 잘못된 예: 전체 명령어를 패턴으로 승인                            │
│    "Bash(codex exec \"[자문 요청]\n\n## 사용자 질문\n...\")"         │
│    → settings.local.json 파싱 에러 발생                             │
├─────────────────────────────────────────────────────────────────────┤
│ ✅ 올바른 예: 와일드카드 패턴으로 승인                               │
│    "Bash(codex *)"                                                   │
│    → 모든 codex 명령을 허용                                         │
└─────────────────────────────────────────────────────────────────────┘
```

**권한 승인 방법:**
1. 권한 요청 시 "Always allow" 선택하지 않음
2. 프로젝트의 `.claude/settings.local.json`에 직접 추가:
   ```json
   {
     "permissions": {
       "allow": [
         "Bash(codex *)"
       ]
     }
   }
   ```

**문제 발생 시:**
- `settings.local.json` 파일에서 `Bash(codex exec "...` 형태의 긴 문자열 패턴 삭제
- `Bash(codex *)` 패턴으로 대체
