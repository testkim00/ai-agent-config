# Subagent Convention

## 3계층 위임 체계

```
┌─────────────────────────────────────────┐
│  오케스트레이터 (Opus)                   │
│  - 전체 계획 수립                        │
│  - 의존성 분석 및 작업 분배              │
│  - 최종 결과 검토                        │
└─────────────┬───────────────────────────┘
              │ 작업 위임
              ▼
┌─────────────────────────────────────────┐
│  감독관 (Opus subagent)                  │
│  - 위임받은 작업 분석                    │
│  - 복잡한 작업: 직접 처리                │
│  - 단순 반복: 실행자에게 재위임          │
└─────────────┬───────────────────────────┘
              │ 단순 작업 위임
              ▼
┌─────────────────────────────────────────┐
│  실행자 (Sonnet/Haiku subagent)          │
│  - 단순 반복 작업 실행                   │
│  - 결과 반환                             │
└─────────────────────────────────────────┘

        ┌─────────────────┐
        │  Codex (자문)    │  ← 어느 계층에서든 호출 가능
        │  - 계획 검토     │
        │  - 전문 분야 자문 │
        └─────────────────┘
```

## 역할 정의

| 계층 | 모델 | 역할 | 책임 |
|------|------|------|------|
| **오케스트레이터** | Opus (직접) | 총괄 | 계획, 분배, 최종 검토 |
| **감독관** | Opus (subagent) | 중간 관리 | 작업 분석, 판단, 재위임 |
| **실행자** | Sonnet/Haiku | 실행 | 단순 반복 작업 처리 |
| **자문** | Codex | 동료 | 검토, 전문 지식 제공 |

## 위임 기준

### 오케스트레이터 → 감독관

| 상황 | 처리 |
|------|------|
| 독립적인 큰 작업 단위 | ✅ 감독관에게 위임 |
| 의존성 있는 순차 작업 | ✅ 감독관에게 순서대로 위임 |
| 단순 1~2개 작업 | ❌ 직접 또는 실행자 직접 호출 |

### 감독관 → 실행자

| 상황 | 처리 |
|------|------|
| 복잡한 판단 필요 | ❌ 직접 처리 |
| 단순 반복 1~2개 | ❌ 직접 처리 |
| 단순 반복 3개+ | ✅ 실행자 병렬 위임 |

### 병렬 실행 조건

| 조건 | 병렬 가능 |
|------|----------|
| 의존성 없음 | ✅ |
| 결과 의존 | ❌ |
| 같은 파일 수정 | ❌ |

## 호출 예시

### 감독관 호출 (오케스트레이터 → 감독관)

```python
Task(
    subagent_type="general-purpose",
    model="opus",
    prompt="""
    [작업]: API 엔드포인트 리팩토링
    [범위]: src/api/users.py, src/api/orders.py
    [목표]: 중복 코드 제거, 에러 핸들링 통일
    [권한]: 필요시 실행자(sonnet) 위임 가능
    """
)
```

### 실행자 호출 (감독관 → 실행자)

```python
# 병렬 실행 (한 메시지에 여러 Task)
Task(model="sonnet", prompt="파일 A 처리: ...")
Task(model="sonnet", prompt="파일 B 처리: ...")
Task(model="sonnet", prompt="파일 C 처리: ...")
```

### Codex 자문 (어느 계층에서든)

```bash
# 계획 검토
codex exec "이 리팩토링 계획을 검토해줘: ..." --full-auto

# 전문 지식
codex exec "React 18 concurrent 모드 best practice" --sandbox danger-full-access
```

## 핵심 원칙

1. **subagent 생성 비용 > 실행 비용**이면 직접 처리
2. **감독관**은 판단과 재위임 권한 보유
3. **실행자**는 단순 작업만 수행 (판단 X)
4. **Codex**는 계층 무관하게 자문 역할

## 참고

- 설정: [config.md](./config.md)
- 템플릿: [templates/](./templates/)
