# DB Query 템플릿 가이드

쿼리 결과를 문서 템플릿에 매핑하여 파일로 출력하는 방법을 설명합니다.

## 경로 설정

| 항목 | 경로 | 설명 |
|------|------|------|
| 템플릿 | `~/Projects/db-templates/` | 템플릿 파일 저장 위치 |
| 출력 | `~/Projects/db-outputs/` | 생성된 파일 저장 위치 |

## 플레이스홀더 문법

### 단일 값
```
{{column_name}}
```
쿼리 결과의 첫 번째 행에서 해당 컬럼 값을 삽입합니다.

### 반복 영역
```
{{#rows}}
  ... {{column_name}} ...
{{/rows}}
```
쿼리 결과의 모든 행에 대해 해당 영역을 반복합니다.

### 시스템 변수
| 변수 | 설명 | 예시 값 |
|------|------|---------|
| `{{@today}}` | 현재 날짜 | 2026-01-17 |
| `{{@now}}` | 현재 시간 | 2026-01-17 14:30:52 |
| `{{@count}}` | 총 행 수 | 86 |
| `{{@page}}` | 현재 페이지 (PDF용) | 1 |

---

## 엑셀 템플릿 (.xlsx)

### 기본 구조
```
┌────────────────────────────────────────────────────────┐
│ A1: 직원 목록                                           │
│ A2: 작성일: {{@today}}  |  총 인원: {{@count}}명        │
│ A3: (빈 행)                                             │
│ A4: 사번      | 이름      | 부서      | 입사일          │ ← 헤더
│ A5: {{#rows}}                                           │ ← 반복 시작
│ A5: {{emp_id}} | {{emp_name}} | {{dept_name}} | {{enter_date}} │
│     {{/rows}}                                           │ ← 반복 끝
└────────────────────────────────────────────────────────┘
```

### 엑셀 템플릿 규칙

1. **반복 영역**: `{{#rows}}`와 `{{/rows}}`는 같은 행에 있어야 함
2. **데이터 시작 행**: 반복 마커가 있는 행부터 데이터 삽입
3. **스타일 유지**: 템플릿 행의 서식(폰트, 색상, 테두리)이 복사됨
4. **수식 지원**: 데이터 영역 외부의 수식은 그대로 유지

### 엑셀 템플릿 예시

**employee-list.xlsx**
| 셀 | 내용 |
|----|------|
| A1 | `도급직원 입사자 목록` |
| A2 | `작성일: {{@today}}` |
| B2 | `총 {{@count}}명` |
| A4 | `사번` |
| B4 | `사업장` |
| C4 | `입사일` |
| D4 | `상태` |
| A5 | `{{#rows}}{{emp_id}}` |
| B5 | `{{site_id}}` |
| C5 | `{{enter_date}}` |
| D5 | `{{emp_status}}{{/rows}}` |

---

## 워드 템플릿 (.docx)

### 기본 구조
```
                    직원 명단 보고서

작성일: {{@today}}
총 인원: {{@count}}명

{{#rows}}
사번: {{emp_id}}
이름: {{emp_name}}
부서: {{dept_name}}
입사일: {{enter_date}}
──────────────────
{{/rows}}
```

### 워드 템플릿 규칙

1. **반복 영역**: 문단 단위로 반복
2. **테이블 지원**: 테이블 내 반복도 가능
3. **스타일 유지**: 글꼴, 크기, 색상 등 유지

### 테이블 형식 예시
```
┌──────────┬──────────┬──────────┐
│ 사번     │ 이름     │ 입사일   │
├──────────┼──────────┼──────────┤
│ {{#rows}}                      │
│ {{emp_id}} │ {{emp_name}} │ {{enter_date}} │
│ {{/rows}}                      │
└──────────┴──────────┴──────────┘
```

---

## 파워포인트 템플릿 (.pptx)

### 사용 시나리오
- 데이터 기반 보고서 프레젠테이션
- 차트/그래프와 함께 사용

### 규칙
1. **텍스트 상자**: 플레이스홀더는 텍스트 상자 내에 배치
2. **슬라이드 반복**: `{{#slides}}...{{/slides}}`로 슬라이드 복제 가능

---

## 출력 형식 변환

### 지원 변환 매트릭스

| 템플릿 | → xlsx | → pdf | → csv | → docx |
|--------|--------|-------|-------|--------|
| .xlsx  | O      | O     | O     | -      |
| .docx  | -      | O     | -     | O      |
| .pptx  | -      | O     | -     | -      |

### 변환 시 주의사항

**xlsx → pdf**
- 인쇄 영역 설정 권장
- 페이지 나눔 자동 처리

**xlsx → csv**
- 첫 번째 시트만 변환
- 서식 정보 손실

**docx → pdf**
- 레이아웃 그대로 유지
- 폰트 임베딩 필요할 수 있음

---

## document-skills 활용

템플릿 처리 시 다음 스킬들을 활용합니다:

### 엑셀 처리
```
document-skills:xlsx
```
- 템플릿 읽기/쓰기
- 셀 데이터 조작
- 수식 및 서식 유지

### 워드 처리
```
document-skills:docx
```
- 템플릿 읽기/쓰기
- 테이블 조작
- 스타일 유지

### PDF 변환
```
document-skills:pdf
```
- 문서 → PDF 변환
- PDF 병합/분할

### 파워포인트 처리
```
document-skills:pptx
```
- 슬라이드 조작
- 텍스트 교체

---

## 템플릿 작성 팁

### 1. 컬럼명 확인
쿼리 결과의 컬럼명을 정확히 사용하세요.
```sql
SELECT emp_id, emp_name, enter_date FROM hrdEmpMaster
```
→ `{{emp_id}}`, `{{emp_name}}`, `{{enter_date}}`

### 2. 별칭(Alias) 활용
긴 컬럼명은 별칭으로 단순화:
```sql
SELECT emp_id AS 사번, emp_name AS 이름 FROM hrdEmpMaster
```
→ `{{사번}}`, `{{이름}}`

### 3. 미리보기
템플릿 작성 후 적은 데이터로 테스트:
```
/db:query 직원 3명만 | employee-list.xlsx
```

### 4. 날짜 포맷
SQL에서 원하는 형식으로 변환:
```sql
SELECT CONVERT(varchar, enter_date, 23) AS enter_date  -- YYYY-MM-DD
```

---

## 샘플 템플릿

`~/Projects/db-templates/` 폴더에 다음 샘플이 제공됩니다:

| 파일명 | 용도 |
|--------|------|
| `employee-list.xlsx` | 직원 목록 기본 템플릿 |
| `monthly-report.xlsx` | 월간 보고서 템플릿 |
| `employee-card.docx` | 직원 카드 양식 |
